# AFF
# å¦‚æœä½ æƒ³æ”¯æŒæˆ‘ï¼Œå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥è´­ä¹°æœºåœº
# æ„Ÿè°¢æ”¯æŒ
# 1. ç¨³è”äº‘ï¼š çŸ­é“¾æ¥ https://shortlink181.github.io/1
# 2. wgetcloud é‚€è¯·ç : HRZc03 https://invite.wgetcloud.ltd/auth/register?code=HRZc03 
# 2. å¯ä¹äº‘ é‚€è¯·ç : nQ7AQHxE https://coke.buyzur.com/#/register?code=nQ7AQHxE

# å®˜æ–¹å‚è€ƒé…ç½® https://github.com/MetaCubeX/mihomo/blob/Alpha/docs/config.yaml
# å®˜æ–¹é…ç½®è¯¦è§£ https://wiki.metacubex.one/config/

mixed-port: 7890
allow-lan: false
bind-address: '*'
# è‹¥é always, SUB-RULE ä¸ç”Ÿæ•ˆ
find-process-mode: always
mode: rule
geox-url:
  geoip: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
geo-auto-update: true
# å•ä½ä¸ºå°æ—¶
geo-update-interval: 24
log-level: error
ipv6: false
external-controller: 127.0.0.1:9090
secret: ""
external-controller-cors:
  allow-origins:
    - '*'
  allow-private-network: false
external-ui: ui
external-ui-url: 'https://ghproxy.net/https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip'
# external-ui-url: 'https://ghproxy.net/https://github.com/MetaCubeX/Yacd-meta/archive/refs/heads/gh-pages.zip'
global-client-fingerprint: chrome
profile:
  store-selected: true
  store-fake-ip: true
unified-delay: true
tcp-concurrent: true
geodata-mode: true
geodata-loader: standard

dns:
  enable: true
  prefer-h3: false
  use-hosts: true
  use-system-hosts: false
  respect-rules: false
  listen: 0.0.0.0:10053
  ipv6: false
  enhanced-mode: redir-host
  # æ›´å¤š DNS å‚è€ƒ: https://senzyo.net/2022-22/
  default-nameserver:
    - 'udp://1.2.4.8'
  nameserver-policy:
  # ä¸º proxy-provider ä½¿ç”¨çš„åŸŸåæŒ‡å®š DNS æœåŠ¡å™¨, ä¸ç„¶æ— æ³•ä¸‹è½½è®¢é˜…æ–‡ä»¶
    '+.pronetwork.top,+.wd-turbo.com': ['https://dns.alidns.com/dns-query']
    'geosite:geolocation-!cn': ['https://8.8.8.8/dns-query#ğŸš€ é»˜è®¤å‡ºç«™']
    'geosite:cn': ['https://dns.alidns.com/dns-query']
  nameserver:
    - 'https://8.8.8.8/dns-query#ğŸš€ é»˜è®¤å‡ºç«™'
  proxy-server-nameserver:
    - 'https://dns.alidns.com/dns-query'

sniffer:
  enable: false
  force-dns-mapping: true
  parse-pure-ip: false
  override-destination: false

tun:
  enable: true
  stack: system
  auto-route: true
  auto-detect-interface: true
  dns-hijack:
    - 'udp://any:53'
    - 'tcp://any:53'
  strict_route: true
  endpoint-independent-nat: false
  exclude-package:
    - 'com.android.captiveportallogin'
    - 'org.localsend.localsend_app'

urltest: &urltest
  type: url-test
  disable-udp: false
  url: 'https://www.gstatic.com/generate_204'
  # å•ä½ä¸ºç§’, ä»…å½±å“ proxies ä¸‹çš„èŠ‚ç‚¹
  interval: 600
  # å•ä½ä¸ºæ¯«ç§’
  timeout: 2000
  # å•ä½ä¸ºæ¯«ç§’
  tolerance: 10
  lazy: false
  expected-status: 204
  use:
    - 'Provider1'

select1: &select1
  type: select
  disable-udp: false
  proxies:
    - 'ğŸš€ é»˜è®¤å‡ºç«™'
    - 'DIRECT'
    - 'ğŸ“Œ å•é€‰èŠ‚ç‚¹'
    - 'ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹'
    - 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹'
    - 'ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹'
    - 'ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹'
    - 'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹'
    - 'ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹'

proxy-groups:
  - name: 'ğŸš€ é»˜è®¤å‡ºç«™'
    type: select
    disable-udp: false
    proxies:
      - 'ğŸŒ æ—¥éŸ©å°æ–°'
      - 'ğŸ“Œ å•é€‰èŠ‚ç‚¹'
      - 'ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹'
      - 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹'
      - 'ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹'
      - 'ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹'
      - 'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹'
      - 'ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹'
  - name: 'ğŸŒ æ—¥éŸ©å°æ–°'
    filter: 'ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|JP|Japan|ğŸ‡°ğŸ‡·|éŸ©å›½|KR|South Korea|ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Taiwan|ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|SG|Singapore'
    <<: *urltest
  - name: 'ğŸ“Œ å•é€‰èŠ‚ç‚¹'
    type: select
    disable-udp: false
    exclude-filter: 'å‰©ä½™|æµé‡|raffic|æœ‰æ•ˆ|æ—¶é—´|åˆ°æœŸ|xpire|åœ°å€|ç½‘å€|å®˜ç½‘|è‡ªåŠ¨|æœ€ä¼˜|æœ€å¿«'
    use:
      - 'Provider1'
  - name: 'ğŸ“¥ Downloader'
    <<: *select1
  - name: 'ğŸ® Game'
    <<: *select1
  - name: 'ğŸ” Google'
    <<: *select1
  - name: 'â˜ï¸ OneDrive'
    <<: *select1
  - name: 'ğŸ¤– OpenAI'
    <<: *select1
  - name: 'ğŸªŸ Microsoft'
    <<: *select1
  - name: 'ğŸ–¥ï¸ SSH'
    <<: *select1
  - name: 'ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹'
    filter: 'ğŸ‡­ğŸ‡°|é¦™æ¸¯|HK|Hong Kong'
    <<: *urltest
  - name: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹'
    filter: 'ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|JP|Japan'
    <<: *urltest
  - name: 'ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹'
    filter: 'ğŸ‡°ğŸ‡·|éŸ©å›½|KR|South Korea'
    <<: *urltest
  - name: 'ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹'
    filter: 'ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Taiwan'
    <<: *urltest
  - name: 'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹'
    filter: 'ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|SG|Singapore'
    <<: *urltest
  - name: 'ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹'
    filter: 'ğŸ‡ºğŸ‡¸|ç¾å›½|US|USA|United States'
    <<: *urltest

rules:
  # geoip.dat ç±»åˆ«: https://github.com/Loyalsoldier/geoip/tree/release/text
  # geosite.dat ç±»åˆ«: 
  # https://github.com/v2fly/domain-list-community/tree/master/data
  # https://github.com/MetaCubeX/meta-rules-dat?tab=readme-ov-file#geositedatgeositedb-å†…å®¹
  - GEOIP,private,DIRECT,no-resolve
  - PROCESS-NAME,localsend,DIRECT
  - PROCESS-NAME,localsend_app.exe,DIRECT
  - SUB-RULE,(PROCESS-NAME,ssh),ssh
  - SUB-RULE,(PROCESS-NAME,ssh.exe),ssh
  - SUB-RULE,(PROCESS-NAME,ssh-agent.exe),ssh
  - DOMAIN-SUFFIX,copymanga.site,ğŸš€ é»˜è®¤å‡ºç«™
  - DOMAIN-SUFFIX,copymanga.tv,ğŸš€ é»˜è®¤å‡ºç«™
  - DOMAIN-SUFFIX,mangafuna.xyz,ğŸš€ é»˜è®¤å‡ºç«™
  - DOMAIN-SUFFIX,mangafunb.fun,ğŸš€ é»˜è®¤å‡ºç«™
  - DOMAIN-SUFFIX,senzyo.net,ğŸš€ é»˜è®¤å‡ºç«™
  - SUB-RULE,(RULE-SET,downloader),downloader
  - GEOSITE,category-games@cn,DIRECT
  - GEOSITE,category-games,ğŸ® Game
  - GEOSITE,google,ğŸ” Google
  - GEOIP,google,ğŸ” Google,no-resolve
  - GEOSITE,onedrive,â˜ï¸ OneDrive
  - GEOSITE,openai,ğŸ¤– OpenAI
  - GEOSITE,microsoft,ğŸªŸ Microsoft
  - GEOSITE,geolocation-!cn,ğŸš€ é»˜è®¤å‡ºç«™
  - GEOSITE,cn,DIRECT
  - GEOIP,cn,DIRECT,no-resolve
  - MATCH,ğŸš€ é»˜è®¤å‡ºç«™
sub-rules:
  downloader:
    - GEOSITE,cn,DIRECT
    - GEOIP,cn,DIRECT,no-resolve
    - MATCH,ğŸ“¥ Downloader
  ssh:
    - GEOSITE,cn,DIRECT
    - GEOIP,cn,DIRECT,no-resolve
    - MATCH,ğŸ–¥ï¸ SSH

proxy-providers:
  Provider1:
    type: http
    url: "https://example.com"
    path: ./proxy_providers/Provider1.yaml
    # å•ä½ä¸ºç§’
    interval: 86400
    proxy: DIRECT
    health-check:
      enable: true
      url: 'https://www.gstatic.com/generate_204'
      # å•ä½ä¸ºç§’, ä»…å½±å“ proxy-group ä¸­ use ä¸‹çš„èŠ‚ç‚¹
      interval: 600
      # å•ä½ä¸ºæ¯«ç§’
      timeout: 2000
      lazy: false
      expected-status: 204
    override:
      udp: true
      up: '30 Mbps'
      down: '90 Mbps'

rule-providers:
  downloader:
    type: http
    url: 'https://gitlab.com/senzyo_sama/as-gist/-/raw/master/Rule/Clash/downloader.yaml'
    path: ./rule-providers/downloader.yaml
    # å•ä½ä¸ºç§’
    interval: 604800
    behavior: classical
    format: yaml
